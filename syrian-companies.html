
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>دليل شركات سوريا</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background: #f9f9f9; direction: rtl; }
    h1 { color: #0077cc; }
    .filters { margin-bottom: 20px; }
    select { padding: 10px; margin-left: 10px; }
    .company-card {
      background: white; padding: 15px; margin-bottom: 15px;
      border-radius: 8px; box-shadow: 0 0 8px rgba(0,0,0,0.1);
      display: flex; align-items: center; gap: 15px;
    }
    .company-card img {
      width: 80px; height: 80px; object-fit: cover;
      border-radius: 6px;
    }
    .company-details { flex: 1; }
    .company-details h3 { margin: 0 0 5px; }
    .company-details p { margin: 3px 0; color: #555; font-size: 14px; }
  </style>
</head>
<body>
  <h1>دليل شركات سوريا</h1>
  <div class="filters">
    <select id="filterCity">
      <option value="">الكل - المدن</option>
    </select>
    <select id="filterCategory">
      <option value="">الكل - الفئات</option>
    </select>
    <select id="filterSubcategory">
      <option value="">الكل - التخصصات</option>
    </select>
  </div>

  <div id="companiesContainer"></div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
    import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBDWoBjn44LTyG8K58_M6ko36GdFJgyuhg",
      authDomain: "eymtax-bedf4.firebaseapp.com",
      projectId: "eymtax-bedf4",
      storageBucket: "eymtax-bedf4.firebasestorage.app",
      messagingSenderId: "522260291396",
      appId: "1:522260291396:web:2e23bfc6b3158a2cba8111",
      measurementId: "G-XBZ3FFJRDG"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const companiesContainer = document.getElementById("companiesContainer");

    const cityFilter = document.getElementById("filterCity");
    const categoryFilter = document.getElementById("filterCategory");
    const subcategoryFilter = document.getElementById("filterSubcategory");

    function createCard(company) {
      return \`
        <div class="company-card">
          <img src="\${company.imageBase64}" alt="logo" />
          <div class="company-details">
            <h3>\${company.name}</h3>
            <p><strong>الفئة:</strong> \${company.category}</p>
            <p><strong>التخصص:</strong> \${company.subcategory}</p>
            <p><strong>المدينة:</strong> \${company.city}</p>
            <p>\${company.description}</p>
          </div>
        </div>
      \`;
    }

    function populateFilters(companies) {
      const cities = new Set();
      const categories = new Set();
      const subcategories = new Set();

      companies.forEach(c => {
        cities.add(c.city);
        categories.add(c.category);
        subcategories.add(c.subcategory);
      });

      cities.forEach(city => {
        const opt = document.createElement("option");
        opt.value = city;
        opt.textContent = city;
        cityFilter.appendChild(opt);
      });

      categories.forEach(cat => {
        const opt = document.createElement("option");
        opt.value = cat;
        opt.textContent = cat;
        categoryFilter.appendChild(opt);
      });

      subcategories.forEach(sub => {
        const opt = document.createElement("option");
        opt.value = sub;
        opt.textContent = sub;
        subcategoryFilter.appendChild(opt);
      });
    }

    function applyFilters(companies) {
      const city = cityFilter.value;
      const category = categoryFilter.value;
      const subcategory = subcategoryFilter.value;

      return companies.filter(c => {
        return (!city || c.city === city) &&
               (!category || c.category === category) &&
               (!subcategory || c.subcategory === subcategory);
      });
    }

    async function loadCompanies() {
      const snapshot = await getDocs(collection(db, "companies"));
      const companies = snapshot.docs.map(doc => doc.data());
      populateFilters(companies);

      function render() {
        companiesContainer.innerHTML = "";
        const filtered = applyFilters(companies);
        filtered.forEach(company => {
          companiesContainer.innerHTML += createCard(company);
        });
      }

      cityFilter.addEventListener("change", render);
      categoryFilter.addEventListener("change", render);
      subcategoryFilter.addEventListener("change", render);

      render();
    }

    window.addEventListener("DOMContentLoaded", loadCompanies);
  </script>
</body>
</html>
